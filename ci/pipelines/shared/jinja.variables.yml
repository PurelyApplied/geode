#
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

repository:
  project: geode

test_configuration_base:  &default_test_configuration
  name: "Override this."
  CPUS: "8"
  RAM: "16"
  ARTIFACT_SLUG: "Override this."
  # TODO: CallStack timeout is 30 minutes in many places, but execute_test timeout is 10?
  CALL_STACK_TIMEOUT: "1800"
  PARALLEL_DUNIT: "false"
  DUNIT_PARALLEL_FORKS: "4"
  GRADLE_TASK: "OverrideThis"
  PARALLEL_GRADLE: "false"
  execute_test_timeout: 10m

build_test:
  <<: *default_test_configuration
  name: "Build"
  ARTIFACT_SLUG: build
  # Actual gradle task is quite a bit more than "build" but is hard-coded in execute_build.sh
  # It's consumption is more like a "TEST_RESULTS_DESTINATIONS_DIRECTORY_STUB_THING.
  GRADLE_TASK: build
examples_test:
  <<: *default_test_configuration
  name: "TestExamples"
  ARTIFACT_SLUG: examples
  # Actual gradle task is "clean runAll" but is hard-coded in execute_build_examples.sh
  # It's consumption is more like a "TEST_RESULTS_DESTINATIONS_DIRECTORY_STUB_THING.
  GRADLE_TASK: runAll
  execute_test_timeout: 30m

publish_artifacts:
  name: "PublishArtifacts"
  CPUS: "8"
  RAM: "16"
  execute_test_timeout: 10m

java_test_versions:
- name: OpenJDK8
  version: 8
- name: OpenJDK11
  version: 11

benchmarks:
  baseline_version: "1.8.0"

java_build_version:
  name: OpenJDK8
  version: 8

tests:
- <<: *default_test_configuration
  name: "Unit"
  ARTIFACT_SLUG: unittestfiles
  DUNIT_PARALLEL_FORKS: "0"
  GRADLE_TASK: test
  PARALLEL_GRADLE: "true"
- <<: *default_test_configuration
  name: "Acceptance"
  CPUS: "8"
  RAM: "12"
  ARTIFACT_SLUG: acceptancetestfiles
  DUNIT_PARALLEL_FORKS: "0"
  GRADLE_TASK: acceptanceTest
  execute_test_timeout: 45m
- <<: *default_test_configuration
  name: "Distributed"
  CPUS: "96"
  RAM: "180"
  ARTIFACT_SLUG: distributedtestfiles
  CALL_STACK_TIMEOUT: "7200"
  DUNIT_PARALLEL_FORKS: "24"
  GRADLE_TASK: distributedTest
  execute_test_timeout: 2h15m
  PARALLEL_DUNIT: "true"
- <<: *default_test_configuration
  name: "Integration"
  CPUS: "96"
  RAM: "90"
  ARTIFACT_SLUG: integrationtestfiles
  CALL_STACK_TIMEOUT: "1500"
  DUNIT_PARALLEL_FORKS: "48"
  GRADLE_TASK: integrationTest
  execute_test_timeout: 40m
  PARALLEL_DUNIT: "true"
- <<: *default_test_configuration
  name: "Upgrade"
  CPUS: "96"
  RAM: "160"
  ARTIFACT_SLUG: upgradetestfiles
  CALL_STACK_TIMEOUT: "3000"
  DUNIT_PARALLEL_FORKS: "48"
  GRADLE_TASK: upgradeTest
  execute_test_timeout: 1h
  PARALLEL_DUNIT: "true"
- <<: *default_test_configuration
  name: "StressNew"
  CPUS: "96"
  RAM: "210"
  ARTIFACT_SLUG: stressnewtestfiles
  CALL_STACK_TIMEOUT: "7200"
  DUNIT_PARALLEL_FORKS: "24"
  GRADLE_TASK: repeatTest
  execute_test_timeout: 2h15m
  PARALLEL_DUNIT: "true"
- <<: *default_test_configuration
  name: "WindowsAcceptance"
  CPUS: "16"
  RAM: "64"
  ARTIFACT_SLUG: windows-acceptancetestfiles
  DUNIT_PARALLEL_FORKS: "0"
  GRADLE_TASK: :geode-assembly:acceptanceTest
  execute_test_timeout: 6h
- <<: *default_test_configuration
  name: "WindowsGfshDistributed"
  CPUS: "16"
  RAM: "64"
  ARTIFACT_SLUG: windows-gfshdistributedtest
  DUNIT_PARALLEL_FORKS: "0"
  GRADLE_TASK: distributedTest
  GRADLE_TASK_OPTIONS: "-PtestCategory=org.apache.geode.test.junit.categories.GfshTest"
  execute_test_timeout: 6h
  PARALLEL_DUNIT: "false"
  PARALLEL_GRADLE: "false"
- <<: *default_test_configuration
  name: "WindowsIntegration"
  CPUS: "16"
  RAM: "64"
  ARTIFACT_SLUG: windows-integrationtestfiles
  DUNIT_PARALLEL_FORKS: "0"
  GRADLE_TASK: integrationTest
  execute_test_timeout: 6h
  PARALLEL_DUNIT: "false"
  PARALLEL_GRADLE: "false"
- <<: *default_test_configuration
  name: "WindowsUnit"
  CPUS: "16"
  RAM: "64"
  ARTIFACT_SLUG: windows-unittestfiles
  DUNIT_PARALLEL_FORKS: "0"
  GRADLE_TASK: test
  execute_test_timeout: 6h
  PARALLEL_DUNIT: "false"
