/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/*
 * Configuration for running (dunit) tests in parallel in Docker containers.
 * The container used must hava JAVA_HOME set in it's environment and must
 * have 'java' defined on the path. For example, the relevant Dockerfile
 * content could be:
 *
 *   ENV JAVA_HOME=/opt/jdk1.8.0_u101
 *   ENV PATH=$PATH:$JAVA_HOME/bin
 *
 * In addition, the container must have docker installed.
 *
 * The plugin can be activated with the Gradle property 'parallelDunit'.
 * Additional properties that can be set are:
 *
 *  dunitDockerImage   - The docker image used for running parallel dunits. The
 *                       default image is 'openjdk:8'. The image is required to
 *                       have 'JAVA_HOME' set as an environment variable.
 *  dunitParallelForks - The number of parallel containers that will be
 *                       launched. The default is 8.
 *  dunitDockerUser    - The user used within the docker container to run tests.
 *                       The default is 'root'.
 */

apply plugin: 'com.github.pedjak.dockerized-test'

if (project.hasProperty('parallelDunit')) {
  uiTest.configure(rootProject.ext.dockerConfig)
  repeatUnitTest.configure(rootProject.ext.dockerConfig)

  integrationTest.configure(rootProject.ext.dockerConfig)
  repeatIntegrationTest.configure(rootProject.ext.dockerConfig)

  distributedTest.configure(rootProject.ext.dockerConfig)
  repeatDistributedTest.configure(rootProject.ext.dockerConfig)

  upgradeTest.configure(rootProject.ext.dockerConfig)
  repeatUpgradeTest.configure(rootProject.ext.dockerConfig)

  acceptanceTest.configure(rootProject.ext.dockerConfig)
  repeatAcceptanceTest.configure(rootProject.ext.dockerConfig)
}
